The aim of this subsection is to prove the following theorem:

% Compacte
\vbox{
\theorem[space soundness]
	{\label{soundness}Let $\,\phi\in\C O_\Sigma^+\,$ be an observation over $\,\Sigma\,$.
	\begin{itemize}
		\item $\lang(\phi)\,$ is decidable in non-deterministic logarithmic space.
		\item If $\,\phi\,$ is isometric, then $\lang(\phi)\,$ is decidable in deterministic logarithmic space.
	\end{itemize}
}
}
Actually, the result stands for the complements of these languages, but as {\sc co-NLogspace = NLogspace} by the Immerman-Szelepcs√©nyi theorem, this makes no difference.

\smallskip
The main tool for this purpose is the notion of \emph{computation space}: a finite dimensional subspace of $\,\closedh\,$ on which we will be able to observe the behavior of our wirings. It can be understood as the place where all the relevant computation takes place.% This notion is reminiscent of the notion of separating vector 

\define[separating space]
{A subspace $\,E\,$ of $\,\closedh\,$ is \emph{separating} for a wiring $\,F\,$ whenever $\,F(E)\subseteq E\,$ and $\,F^n(E)=0\,$ implies $\,F^n=0\,$.}

Observations are \emph{finite} sums of wirings. We can naturally associate a finite-dimensional vector space to an observation and a finite set of closed terms.

\define[computation space]
{\label{compspace}Let $\,\{\,t_0,\dots, t_n\,\}\,$ be a set of distinct closed terms and $\,\phi\in\C O_\Sigma^\concrete\,$ an observation.

Let $\,N(\phi)\,$ be the smallest integer and $\,\TT S(\phi)\,$ the smallest (finite) set of closed terms such that $\,\phi \in (\TT S(\phi)^\ast\ptensor \Sigma^\ast\tensor\IO^\ast)\tensor\C S_{N(\phi)}\,$.

\smallskip
The \emph{computation space} $\,\comp_\phi (t_0\dots t_n)\,$ is the subspace of $\,\closedh\,$ generated by the terms
\[s\p \TT c\p \TT d \p (\,a_1\p\,\cdots\,\p a_{N(\phi)}\,\p\, \start)\]
where $\,s\in \TT S(\phi)\,$, $\,\TT c\in \Sigma\,$, $\,\TT d\in\IO\,$ and the $\,a_i\in \{\,t_0,\dots, t_n\,\}\,$.

The dimension of $\,\comp_\phi (t_0\dots t_n)\,$ is $\,|\Sigma| 2 (n+1)^{N(\phi)}|\TT S(\phi)|\,$ (where $\,|A|\,$ is the cardinal of $\,A\,$), which is polynomial in $\,n\,$. 
}



\lemma[separation]
{\label{sep}For any observation $\,\phi\,$ and any word $\,W\,$, the space $\,\comp_\phi(t_0\dots t_n)$ is separating for the wiring $\,\phi \,W(t_0\dots t_n)\,$.}

\proof[of Theorem~\ref{soundness}]{With these lemmas at hand, we can define the non-deterministic algorithm below. It takes as an input the representation $\,W(t_0\dots t_n)\,$ of a word $\,W\,$ of length $\,n\,$. $\phi\,$. 

Being a constant, one can compute once and for all $\,N(\phi)\,$ and $\,S(\phi)\,$.

\begin{multicols}{2}
%\begin{wrapfigure}[18]{l}{0.5\textwidth}
\begin{algorithmic}[1]
%\STATE compute $\,N(\phi)\,$ and $\,S(\phi)\,$
\STATE $D\gets 2|\TT S(\phi)|\,|\Sigma|(n+1)^{N(\phi)}$
\STATE $C\gets 0$
\STATE pick a term $\,v\in\comp_\phi(t_i)\,$\label{pick1}
\WHILE{$C\leq D$}
	\IF{$(\phi W(t_i))(v)=0$} \label{if}
		\RETURN ACCEPT
	\ENDIF
	\STATE pick a term $\,v'\,$ in $\,(\phi W(t_i))(v)\,$ \label{pick2}
	\STATE $v\gets v'$
	\STATE $C\gets C+1$
\ENDWHILE
\RETURN REJECT
\end{algorithmic}
\end{multicols}
%\caption{Nilpotency algorithm}
%\end{wrapfigure}

\smallskip
All computation paths (the \enquote{pick} at lines \ref{pick1} and \ref{pick2} being non-deterministic choices) accept if and only if $\,(\phi W(t_i))^n(\comp_\phi(t_i))=0\,$ for some $\,n\,$ lesser or equal to the dimension $D$ of the computation space $\,\comp_\phi(t_i)\,$.
By Lemma \ref{sep}, this is equivalent to $\,\phi W(t_i)\,$ being nilpotent.

The vector chosen at lines \ref{pick1} is representable by an integer of size at most $D$ and is erased by the one chosen at line \ref{pick2} every time we go through the {\bf while}-loop.
$C$ and $D$ are integers proportional to the dimension of the computation space, which is representable in logarithmic space in the size of the input (Definition~\ref{compspace}).
% Compacte

\smallskip
%The algorithm can run in logarithmic space, because it only needs to store a vector of a vector space of dimension $\,D=2|\TT S(\phi)|\,|\Sigma|(n+1)^{N(\phi)}\,$ (which can be represented as an integer lesser or equal to $\,D\,$), and the two integers $\,C,D\,$.
The computation of $\,(\phi W(t_i))(v)\,$ at line \ref{if} and \ref{pick2} and can be performed in logarithmic space by Proposition \ref{unif-logspace}, as we are unifying closed terms with linear terms.
%all terms used in words representations and observations are linear and share no variables.
% Compacte

\smallskip
Moreover, if $\,\phi\,$ is an isometric wiring, $\,(\phi W(t_i))(v)\,$ consists of a single vector instead of a sum by Lemma \ref{lem_isom}, and there is therefore no non-deterministic choice to be made at line \ref{pick2}.
It is then enough to run the algorithm enumerating all possible vectors of $\,\comp_\phi(t_i)\,$ at line \ref{pick1} to determine the nilpotency of $\,\phi W(t_i)\,$.
}
